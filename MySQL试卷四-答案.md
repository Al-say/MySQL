# MySQL数据库原理试卷四-答案解析

## 一、选择题（共20题，每题2分，共40分）

1. 答案：C
   解析：数据库管理系统的主要功能包括数据定义、数据操纵、数据控制等，数据打印不是DBMS的主要功能。

2. 答案：A
   解析：在关系数据库中，一个关系就是一张二维表，行代表记录，列代表字段。

3. 答案：C
   解析：主键是用来唯一标识一个元组（记录）的字段或字段组合。候选键是可以作为主键的候选属性，外键用于表间关联。

4. 答案：D
   解析：事务的四大特性是原子性（Atomicity）、一致性（Consistency）、隔离性（Isolation）和持久性（Durability），简称ACID。可扩展性不是事务的特性。

5. 答案：C
   解析：DDL包括CREATE、ALTER、DROP等操作数据库结构的语句。INSERT属于DML（数据操作语言）。

6. 答案：B
   解析：投影运算是从关系中选取若干列组成新关系的运算。选择是选取满足条件的行。

7. 答案：B
   解析：散列索引适合于频繁更新的字段，因为它的更新成本较低。B树索引虽然查询效率高，但更新成本较大。

8. 答案：A
   解析：从MySQL 5.5.5开始，InnoDB成为MySQL的默认存储引擎，它支持事务、外键等特性。

9. 答案：B
   解析：在E-R图中，椭圆用来表示实体的属性，矩形表示实体，菱形表示关系。

10. 答案：B
    解析：外键是用来在两个表之间建立关联的字段，它引用另一个表的主键。

11. 答案：B
    解析：REVOKE命令用于撤销已经授予的权限，而GRANT用于授予权限。

12. 答案：C
    解析：逻辑设计阶段的主要任务是将概念模型转换为具体的数据模型（如关系模型）。

13. 答案：D
    解析：视图的主要作用包括简化查询、保证数据安全性和数据独立性，但不会提高存储效率，因为视图本身不存储数据。

14. 答案：D
    解析：触发器可以监视的数据操作包括INSERT、UPDATE、DELETE，而SELECT是查询操作，不会触发触发器。

15. 答案：B
    解析：BCNF要求所有决定因素都必须是候选键，消除了非主属性对码的部分函数依赖和传递函数依赖。

16. 答案：A
    解析：在MySQL中，START TRANSACTION或BEGIN是开启事务的标准语法。

17. 答案：C
    解析：经常在WHERE子句中使用的字段最适合建立索引，因为可以显著提高查询效率。

18. 答案：B
    解析：数据库并发控制的主要目的是保证数据的一致性，防止多个用户同时操作数据时产生冲突。

19. 答案：D
    解析：BETWEEN是比较运算符，不是约束类型。合法的约束类型包括NOT NULL、UNIQUE、PRIMARY KEY等。

20. 答案：B
    解析：规范化的主要目的是消除数据冗余，避免数据的插入、删除和更新异常。

## 二、判断题（共10题，每题1分，共10分）

1. （√）
   解析：概念模型是对现实世界的抽象，独立于具体的DBMS实现。

2. （×）
   解析：主键不能包含空值，这是实体完整性的要求。

3. （×）
   解析：视图是虚表，不存储实际数据，数据来自基表。

4. （√）
   解析：这是候选键的定义特征，用于唯一标识元组。

5. （×）
   解析：InnoDB存储引擎支持外键约束，这是它区别于MyISAM的重要特征之一。

6. （×）
   解析：SELECT属于DML（数据操作语言），不是DDL（数据定义语言）。

7. （√）
   解析：数据库恢复依赖日志文件中记录的操作信息。

8. （√）
   解析：死锁是并发事务相互等待对方释放资源的现象。

9. （×）
   解析：一个表可以建立多个索引来提高不同查询的效率。

10. （×）
    解析：规范化程度越高，虽然减少了数据冗余，但可能需要更多的表连接操作，不一定会提高查询效率。

## 三、SQL语句题（共5题，每题5分，共25分）

1. 查询2023年销售总额排名前三的产品名称和销售总额：
```sql
SELECT p.产品名称, SUM(d.数量 * d.实际单价) as 销售总额
FROM 产品 p
JOIN 订单明细 d ON p.产品编号 = d.产品编号
JOIN 订单 o ON d.订单编号 = o.订单编号
WHERE YEAR(o.下单日期) = 2023
GROUP BY p.产品编号, p.产品名称
ORDER BY 销售总额 DESC
LIMIT 3;
```

2. 查询至少购买过所有类别产品的客户名称：
```sql
SELECT c.客户名称
FROM 客户 c
WHERE NOT EXISTS (
    SELECT DISTINCT p.类别
    FROM 产品 p
    WHERE NOT EXISTS (
        SELECT *
        FROM 订单明细 d
        JOIN 订单 o ON d.订单编号 = o.订单编号
        WHERE o.客户编号 = c.客户编号
        AND d.产品编号 IN (
            SELECT 产品编号
            FROM 产品
            WHERE 类别 = p.类别
        )
    )
);
```

3. 创建显示客户订单统计信息的视图：
```sql
CREATE VIEW 客户订单统计 AS
SELECT 
    c.客户名称,
    COUNT(o.订单编号) as 订单数量,
    SUM(o.总金额) as 总金额,
    AVG(o.总金额) as 平均订单金额
FROM 客户 c
LEFT JOIN 订单 o ON c.客户编号 = o.客户编号
GROUP BY c.客户编号, c.客户名称;
```

4. 查询从未被订购过的产品信息：
```sql
SELECT p.*
FROM 产品 p
WHERE NOT EXISTS (
    SELECT *
    FROM 订单明细 d
    WHERE d.产品编号 = p.产品编号
);
```

5. 统计每个类别的产品信息：
```sql
SELECT 
    类别,
    COUNT(*) as 产品数量,
    AVG(单价) as 平均单价,
    SUM(库存量) as 总库存量
FROM 产品
GROUP BY 类别;
```

## 四、数据库设计题（15分）

1. 主要实体和联系分析：
- 实体：学生、课程、教师
- 联系：
  - 教师-课程：多对多（一个教师可教多门课，一门课可由多个教师教授）
  - 学生-课程：多对多（一个学生可选多门课，一门课可被多个学生选修）
  - 需要记录选课成绩信息

2. E-R图：
```
[学生]-(选修)-[课程]
属性：学号、姓名、性别、班级
    
[教师]-(讲授)-[课程]
属性：工号、姓名、职称、所属院系
    
[课程]
属性：课程号、课程名、学分、课时
    
[选修]
属性：成绩
```

3. 关系模式转换：
```
学生(学号[主键], 姓名, 性别, 班级)
教师(工号[主键], 姓名, 职称, 所属院系)
课程(课程号[主键], 课程名, 学分, 课时)
教师课程(工号[外键], 课程号[外键], 主键[工号,课程号])
学生选课(学号[外键], 课程号[外键], 成绩, 主键[学号,课程号])
```

## 五、关系规范化题（10分）

1. 候选码：
- 分析函数依赖：A→B→C→D→E
- 从依赖图可以看出，A是所有属性的决定因素
- 因此，{A}是唯一的候选码

2. 范式级别：
- 满足1NF（所有属性都是原子的）
- 不满足2NF，因为没有部分函数依赖
- 不满足3NF，因为存在非主属性对候选码的传递函数依赖（B→C，C→D，D→E）
- 所以该关系模式属于1NF

3. BCNF分解：
将R分解为：
```
R1(A, B)  F1={A→B}
R2(B, C)  F2={B→C}
R3(C, D)  F3={C→D}
R4(D, E)  F4={D→E}
```
分解后的每个关系都满足BCNF，因为在每个关系中，决定因素都是候选码。
